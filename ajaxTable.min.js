const _ajaxTable=[];!function(a){a.fn.extend({ajaxTable:function(e){this.defaultOptions={source:!1,sourceContext:{},printButtons:!0,orderBy:0,orderSort:"desc",logging:!1,contentType:null,onReady:function(a,e){},beforeAjax:function(a,e){},onUpdate:function(a,e){}};let t=a.extend({},this.defaultOptions,e),l=window.navigator.userLanguage||window.navigator.language;function o(a,e){function t(a,e,t,l,o,n){for(var i=t,r=l+1,d=t;;){var s;if(n(a[i],a[r])<=0){if(e[d++]=a[i++],i>l){do{e[d++]=a[r++]}while(r<=o);break}}else if(e[d++]=a[r++],r>o){do{e[d++]=a[i++]}while(i<=l);break}}}function l(a,e,l,n,i){if(!(n<l))if(n!=l){var r=Math.floor(l+(n-l)/2);o(a,e,l,r,i),o(a,e,r+1,n,i),t(a,e,l,r,n,i)}else e[l]=a[l]}function o(a,e,o,n,i){if(!(n<=o)){var r=Math.floor(o+(n-o)/2);l(a,e,o,r,i),l(a,e,r+1,n,i),t(e,a,o,r,n,i)}}function n(a,e){var t=a.slice(0);return o(a,t,0,a.length-1,e),a}return n(a,e)}function n(a){var e=document.createElement("template");return a=a.trim(),e.innerHTML=a,e.content.firstChild}function i(a,e){let t=2,l=a-2,o=a+2+1,n=[];return(n=Array.from({length:e},(a,e)=>e+1).filter(a=>a&&a>=l&&a<o)).length>1&&(n[0]>1&&(n[0]>2&&n.unshift("..."),n.unshift(1)),n[n.length-1]<e&&(n[n.length-1]!==e-1&&n.push("..."),n.push(e))),n}function r(e,t,l,o){for(li of(a(".pagination-page,.pagination-etc",e).remove(),1!=t?a(".pagination-prev",e).removeClass("disabled"):a(".pagination-prev",e).addClass("disabled"),t<l?a(".pagination-next",e).removeClass("disabled"):a(".pagination-next",e).addClass("disabled"),i(_ajaxTable[o].page,l)))a(".pagination-next",e).before('<li class="'+("..."==li?"pagination-etc":"pagination-page")+(li==t?" active":"")+'" data-page="'+li+'">'+li+"</li>");_ajaxTable[o].page=t,a("#ajax-table-item-start-id",e).text(10*(_ajaxTable[o].page-1)+1>_ajaxTable[o].filteredTotal?_ajaxTable[o].filteredTotal:10*(_ajaxTable[o].page-1)+1),a("#ajax-table-item-end-id",e).text(10*_ajaxTable[o].page>_ajaxTable[o].filteredTotal?_ajaxTable[o].filteredTotal:10*_ajaxTable[o].page),a("#ajax-table-item-filtered-total",e).text(_ajaxTable[o].filteredTotal),a("#ajax-table-item-total",e).text(_ajaxTable[o].total)}function d(e,t){a("tbody",e).empty().append(_ajaxTable[t].filteredData.slice(10*(_ajaxTable[t].page-1),10*_ajaxTable[t].page)),_ajaxTable[t].filteredData.slice(10*(_ajaxTable[t].page-1),10*_ajaxTable[t].page).length||a("tbody",e).append('<tr><td class="empty" colspan="'+_ajaxTable[t].columns+'">'+(l.toLowerCase().includes("fr")?"Aucune donnée disponible dans le tableau":"No data available")+"</td></tr>");let o=Math.floor((_ajaxTable[t].filteredTotal-1)/10)+1;r(a(e).next(),_ajaxTable[t].page,o,t)}function s(e,o,i,d,s){let c;new Promise((r,d)=>{!t.source||_ajaxTable[o].dataFullyLoaded||(_ajaxTable[o].activeSearch||_ajaxTable[o].silentData[i])&&!_ajaxTable[o].activeSearch?t.source&&!_ajaxTable[o].dataFullyLoaded&&_ajaxTable[o].silentData[i]?(a("tbody",e).empty().append(_ajaxTable[o].silentData[i]),_ajaxTable[o].silentData[i].length||a("tbody",e).append('<tr><td class="empty" colspan="'+_ajaxTable[o].columns+'">'+(l.toLowerCase().includes("fr")?"Aucune donnée disponible dans le tableau":"No data available")+"</td></tr>"),r(_ajaxTable[o].total)):(a("tbody",e).empty().append(_ajaxTable[o].filteredData.slice(10*(i-1),10*i)),_ajaxTable[o].filteredData.slice(10*(i-1),10*i).length||a("tbody",e).append('<tr><td class="empty" colspan="'+_ajaxTable[o].columns+'">'+(l.toLowerCase().includes("fr")?"Aucune donnée disponible dans le tableau":"No data available")+"</td></tr>"),r(_ajaxTable[o].filteredData.length)):(t.beforeAjax.call(void 0,e,_ajaxTable[o]),t.logging&&console.log("ajaxTable calling source..."),SlickLoader.enable(),a.post({url:t.source,data:{page:i,orderBy:_ajaxTable[o].orderBy,order:_ajaxTable[o].orderSort,search:_ajaxTable[o].search,searchPatterns:_ajaxTable[o].searchPatterns,columns:_ajaxTable[o].columns,total:!0,context:t.sourceContext},contentType:t.contentType,dataType:"json"}).done(d=>{for(tr of(a("tbody",e).empty(),d.data))a("tbody",e).append(tr);d.data.length||a("tbody",e).append('<tr><td class="empty" colspan="'+_ajaxTable[o].columns+'">'+(l.toLowerCase().includes("fr")?"Aucune donnée disponible dans le tableau":"No data available")+"</td></tr>"),_ajaxTable[o].activeSearch||_ajaxTable[o].orderBy!=t.orderBy||_ajaxTable[o].orderSort!=t.orderSort?t.logging&&console.log("ajaxTable temporally recieved "+d.data.length+" items."):(_ajaxTable[o].silentData[""+i]=d.data.map(a=>n(a)),t.logging&&console.log("ajaxTable recieved "+d.data.length+" items.")),SlickLoader.disable(),r(d.total)}).fail((a,e,t)=>{let l="Request Failed: "+e+", "+t;console.log(a),console.log(l),SlickLoader.disable(),d(l)}))}).then(a=>{_ajaxTable[o].page=i,r(d.parent(),i,Math.floor((a-1)/10)+1,o),t.onUpdate.call(void 0,e,_ajaxTable[o])}).catch(a=>{console.warn(a),alert(a)})}function c(e,l,o){t.beforeAjax.call(void 0,o,_ajaxTable[l]),t.logging&&console.log("ajaxTable calling source..."),a.post({url:t.source,data:{page:e,context:t.sourceContext},contentType:t.contentType,dataType:"json"}).done(i=>{_ajaxTable[l].silentData[""+e]=i.data.map(a=>n(a)),t.logging&&console.log("ajaxTable silently recieved "+i.data.length+" items. (page "+e+")"),e<Math.floor((_ajaxTable[l].total-1)/10)+1?c(e+1,l,o):(_ajaxTable[l].dataFullyLoaded=!0,t.printButtons&&(o.nextElementSibling.querySelector(".ajax-table-buttons-loader").classList.add("loaded"),o.nextElementSibling.querySelector(".ajax-table-buttons").classList.add("available")),_ajaxTable[l].data=[].concat(...Object.values(_ajaxTable[l].silentData)),_ajaxTable[l].filteredData=_ajaxTable[l].data,a("tfoot input",o).filter((a,e)=>e.value).each(function(){let e=a(this).parent().index();_ajaxTable[l].filteredData=_ajaxTable[l].filteredData.filter(a=>a.childNodes[e].hasAttribute("data-search")&&a.childNodes[e].attr("data-search").toLowerCase().includes(this.value.toLowerCase())||a.childNodes[e].innerText.toLowerCase().includes(this.value))}),_ajaxTable[l].total=_ajaxTable[l].data.length,_ajaxTable[l].filteredTotal=_ajaxTable[l].filteredData.length,t.logging&&console.log("ajaxTable is done with AJAX tasks."))}).fail((a,t,n)=>{let i="Request Failed: "+t+", "+n;console.log(a),console.log(i),c(e,l,o)})}function b(a){localStorage.setItem(window.location.hostname+window.location.pathname+"_ajaxTable_"+a+"_search",JSON.stringify(_ajaxTable[a].search)),localStorage.setItem(window.location.hostname+window.location.pathname+"_ajaxTable_"+a+"_orderBy",JSON.stringify(_ajaxTable[a].orderBy)),localStorage.setItem(window.location.hostname+window.location.pathname+"_ajaxTable_"+a+"_order",JSON.stringify(_ajaxTable[a].orderSort)),localStorage.setItem(window.location.hostname+window.location.pathname+"_ajaxTable_"+a+"_expires",(new Date).getTime()+36e5)}return this.each(function(e){let i=this;a(this).addClass("ajax-table-processed");let p={orderBy:t.orderBy,orderSort:t.orderSort,search:[],activeSearch:!1,searchPatterns:[],columns:a("thead th",i).length,page:1,total:1,filteredTotal:1,printButtons:t.printButtons,data:[],filteredData:[],silentData:{},dataFullyLoaded:!1},x;p.data=a("tbody>tr",this).get(),p.filteredData=[...p.data],a("tfoot",this).length||a(this).append("<tfoot><tr></tr></tfoot>"),a("tfoot",this).insertAfter(a("thead",this)),a("tfoot tr",this).empty(),a("thead th",this).each(function(){a("tfoot tr",i).append('<td><input type="text" placeholder="'+(l.toLowerCase().includes("fr")?"Entrée pour chercher":"Enter to search")+'"></td>')}),p.search=a("tfoot input",i).get().map(a=>a.value),p.data.length>10&&a("tbody>tr:nth-of-type(n+11)",this).remove(),new Promise((e,o)=>{t.source?(t.beforeAjax.call(void 0,i,p),t.logging&&console.log("ajaxTable calling source..."),SlickLoader.enable(),a.post({url:t.source,data:{total:!0,context:t.sourceContext},dataType:"json",contentType:t.contentType}).done(o=>{for(tr of(a("tbody",this).empty(),o.data))a("tbody",this).append(tr);o.data.length||a("tbody",this).append('<tr><td class="empty" colspan="'+p.columns+'">'+(l.toLowerCase().includes("fr")?"Aucune donnée disponible dans le tableau":"No data available")+"</td></tr>"),p.data=o.data.map(a=>n(a)),p.filteredData=[...p.data],p.silentData[1]=[...p.data],p.total=o.total,p.filteredTotal=o.total,p.searchPatterns=a("tbody tr:nth-of-type(1) td",i).get().map(a=>a.getAttribute("data-search-template")),t.logging&&console.log("ajaxTable recieved "+o.data.length+" items."),SlickLoader.disable(),e()}).fail((a,e,t)=>{let l="Request Failed: "+e+", "+t;console.log(a),console.log(l),SlickLoader.disable(),o(l)})):(p.total=p.data.length,p.filteredTotal=p.filteredData.length,e())}).then(n=>{_ajaxTable.push(p),e=_ajaxTable.length-1;let x=a("thead th",i).eq(_ajaxTable[e].orderBy);x.addClass("sorted"),"asc"==_ajaxTable[e].orderSort&&x.addClass("inverted");let h=a('<aside class="ajax-table-pagination"><ul><li class="pagination-prev disabled">&laquo;</li><li class="pagination-next">&raquo;</li></ul></aside>'),u=Math.floor((_ajaxTable[e].total-1)/10)+1,T=a('<aside class="ajax-table-count"><div>'+(l.toLowerCase().includes("fr")?"Elements":"Items")+' <span id="ajax-table-item-start-id"></span> '+(l.toLowerCase().includes("fr")?"à":"to")+' <span id="ajax-table-item-end-id"></span> '+(l.toLowerCase().includes("fr")?"sur":"of")+' <span id="ajax-table-item-filtered-total"></span> (<span id="ajax-table-item-total"></span> '+(l.toLowerCase().includes("fr")?"au total":"total")+")</div></aside>"),g=a('<div class="ajax-table-utilities"></div>');t.printButtons&&g.append('<aside class="ajax-table-buttons-loader"><div></div></aside>'),t.printButtons&&g.append('<aside class="ajax-table-buttons"><ul><li class="export">Excel</li><li class="export">CSV</li><li class="export">PDF</li></ul></aside>'),g.append(T),g.append(h),a(this).after(g),r(g,1,u,e),h.on("click","li.pagination-page:not(.active)",function(){let t=+a(this).attr("data-page");s(i,e,t,h,u)}),h.on("click","li.pagination-prev:not(.disabled),li.pagination-next:not(.disabled)",function(){let t=+a(this).siblings(".active").attr("data-page");a(this).is(".pagination-prev")?t--:t++,s(i,e,t,h,u)}),t.printButtons&&g.on("click",".ajax-table-buttons li",function(){SlickLoader.enable();const t=document.createElement("table"),l=document.createElement("tbody");switch(t.appendChild(a("thead",i).clone()[0]),t.appendChild(l),_ajaxTable[e].filteredData.forEach(a=>{l.appendChild(a)}),a(this).index()){case 0:a(t).excelExport();break;case 1:a(t).csvExport();break;case 2:let o=a('<iframe class="excel-export" style="visibility: hidden; position: absolute; top:0; right:0;"></iframe>').appendTo("body");o.contents().find("body").append(t),o.contents().find("head").append('<link rel="stylesheet" href="https://rawgit.com/Zenoo/ajaxTable/master/ajaxTable.min.css">'),o[0].contentWindow.print(),o.remove()}SlickLoader.disable()}),a("thead th",this).on("click",function(){a(this).is(".sorted")?a(this).toggleClass("inverted"):a(this).addClass("sorted").siblings().removeClass("sorted inverted");let n=a(this).hasClass("inverted")?1:-1,s;_ajaxTable[e].orderBy=a(this).index(),_ajaxTable[e].orderSort=1==n?"asc":"desc",_ajaxTable[e].page=1,new Promise((s,c)=>{if(t.source&&!_ajaxTable[e].dataFullyLoaded)t.beforeAjax.call(void 0,i,_ajaxTable[e]),t.logging&&console.log("ajaxTable calling source..."),SlickLoader.enable(),a.post({url:t.source,data:{page:_ajaxTable[e].page,orderBy:_ajaxTable[e].orderBy,order:_ajaxTable[e].orderSort,search:_ajaxTable[e].search,searchPatterns:_ajaxTable[e].searchPatterns,columns:_ajaxTable[e].columns,context:t.sourceContext},contentType:t.contentType,dataType:"json"}).done(o=>{for(tr of(a("tbody",i).empty(),o.data))a("tbody",i).append(tr);o.data.length||a("tbody",i).append('<tr><td class="empty" colspan="'+_ajaxTable[e].columns+'">'+(l.toLowerCase().includes("fr")?"Aucune donnée disponible dans le tableau":"No data available")+"</td></tr>"),t.logging&&console.log("ajaxTable temporally recieved "+o.data.length+" items."),r(g,1,u,e),SlickLoader.disable(),s()}).fail((a,e,t)=>{let l="Request Failed: "+e+", "+t;console.log(a),console.log(l),SlickLoader.disable(),c(l)});else{let t=a(this).index();_ajaxTable[e].filteredData=o(_ajaxTable[e].filteredData,(a,e)=>{let l=a.childNodes[t].getAttribute("data-order"),o=e.childNodes[t].getAttribute("data-order"),i=a.childNodes[t].innerText,r=e.childNodes[t].innerText;return a.childNodes[t].hasAttribute("data-order")?isNaN(l)?l.localeCompare(o)*n:+l>+o?n:+l==+o?0:-n:isNaN(i)?i.localeCompare(r)*n:+i>+r?n:+i==+r?0:-n}),d(i,e),s()}}).then(()=>{b(e),t.onUpdate.call(void 0,i,_ajaxTable[e])}).catch(a=>{console.warn(err),alert(a)})}),a("tfoot input",this).on("keyup blur",function(o){if(13==o.keyCode||"blur"==o.type&&this.value!=_ajaxTable[e].search[a(this).parent().index()]){let o;_ajaxTable[e].search[a(this).parent().index()]=this.value,_ajaxTable[e].activeSearch=!!_ajaxTable[e].search.filter(a=>a.length).length,_ajaxTable[e].page=1,new Promise((o,n)=>{t.source&&!_ajaxTable[e].dataFullyLoaded?(t.beforeAjax.call(void 0,i,_ajaxTable[e]),t.logging&&console.log("ajaxTable calling source..."),SlickLoader.enable(),a.post({url:t.source,data:{page:_ajaxTable[e].page,orderBy:_ajaxTable[e].orderBy,order:_ajaxTable[e].orderSort,search:_ajaxTable[e].search,searchPatterns:_ajaxTable[e].searchPatterns,columns:_ajaxTable[e].columns,total:!0,context:t.sourceContext},contentType:t.contentType,dataType:"json"}).done(n=>{for(tr of(a("tbody",i).empty(),n.data))a("tbody",i).append(tr);n.data.length||a("tbody",i).append('<tr><td class="empty" colspan="'+_ajaxTable[e].columns+'">'+(l.toLowerCase().includes("fr")?"Aucune donnée disponible dans le tableau":"No data available")+"</td></tr>"),t.logging&&console.log("ajaxTable temporally recieved "+n.data.length+" items."),_ajaxTable[e].filteredTotal=n.total,r(g,_ajaxTable[e].page,Math.floor((n.total-1)/10)+1,e),SlickLoader.disable(),o()}).fail((a,e,t)=>{let l="Request Failed: "+e+", "+t;console.log(a),console.log(l),SlickLoader.disable(),n(l)})):(_ajaxTable[e].filteredData=_ajaxTable[e].data,Array.from(i.querySelectorAll("tfoot input")).filter(a=>a.value).forEach(a=>{let t=Array.from(a.parentElement.parentElement.children).indexOf(a.parentElement);if(console.log(t),a.value.includes("*")){let l=new RegExp(a.value.toLowerCase().split("*").map(a=>a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")).join(".*").replace(/\s+/g,"\\s+"),"s");_ajaxTable[e].filteredData=_ajaxTable[e].filteredData.filter(a=>a.childNodes[t].hasAttribute("data-search")&&l.test(a.childNodes[t].attr("data-search").toLowerCase())||l.test(a.childNodes[t].innerText.toLowerCase()))}else _ajaxTable[e].filteredData=_ajaxTable[e].filteredData.filter(e=>e.childNodes[t].hasAttribute("data-search")&&e.childNodes[t].attr("data-search").toLowerCase().includes(a.value.toLowerCase())||e.childNodes[t].innerText.toLowerCase().includes(a.value.toLowerCase()))}),_ajaxTable[e].filteredTotal=_ajaxTable[e].filteredData.length,d(i,e),o())}).then(()=>{b(e),t.onUpdate.call(void 0,i,_ajaxTable[e])}).catch(a=>{console.warn(err),alert(a)})}}),t.logging&&console.log("ajaxTable ready."),t.onReady.call(void 0,i,_ajaxTable[e]),t.onUpdate.call(void 0,i,_ajaxTable[e]);let j=localStorage.getItem(window.location.hostname+window.location.pathname+"_ajaxTable_"+e+"_expires");if(j)if((new Date).getTime()<j){_ajaxTable[e].search=JSON.parse(localStorage.getItem(window.location.hostname+window.location.pathname+"_ajaxTable_"+e+"_search")),_ajaxTable[e].orderBy=+JSON.parse(localStorage.getItem(window.location.hostname+window.location.pathname+"_ajaxTable_"+e+"_orderBy")),_ajaxTable[e].orderSort=JSON.parse(localStorage.getItem(window.location.hostname+window.location.pathname+"_ajaxTable_"+e+"_order")),a("tfoot input",i).each(function(a){this.value=_ajaxTable[e].search[a]?_ajaxTable[e].search[a]:""}),_ajaxTable[e].activeSearch=!!_ajaxTable[e].search.filter(a=>a.length).length,a("thead th",i).removeClass("sorted inverted");let o=a("thead th",i).eq(_ajaxTable[e].orderBy);o.addClass("sorted"),"asc"==_ajaxTable[e].orderSort&&o.addClass("inverted"),t.source&&!_ajaxTable[e].dataFullyLoaded?(t.beforeAjax.call(void 0,i,_ajaxTable[e]),t.logging&&console.log("ajaxTable calling source..."),SlickLoader.enable(),a.post({url:t.source,data:{page:_ajaxTable[e].page,orderBy:_ajaxTable[e].orderBy,order:_ajaxTable[e].orderSort,search:_ajaxTable[e].search,searchPatterns:_ajaxTable[e].searchPatterns,columns:_ajaxTable[e].columns,total:!0,context:t.sourceContext},contentType:t.contentType,dataType:"json"}).done(o=>{for(tr of(a("tbody",i).empty(),o.data))a("tbody",i).append(tr);o.data.length||a("tbody",i).append('<tr><td class="empty" colspan="'+_ajaxTable[e].columns+'">'+(l.toLowerCase().includes("fr")?"Aucune donnée disponible dans le tableau":"No data available")+"</td></tr>"),t.logging&&console.log("ajaxTable temporally recieved "+o.data.length+" items."),_ajaxTable[e].page=1,_ajaxTable[e].filteredTotal=o.total,r(g,_ajaxTable[e].page,Math.floor((o.total-1)/10)+1,e),SlickLoader.disable(),t.onUpdate.call(void 0,i,_ajaxTable[e])}).fail((a,e,t)=>{let l="Request Failed: "+e+", "+t;console.log(a),console.log(l),SlickLoader.disable()})):(_ajaxTable[e].filteredData=_ajaxTable[e].data,_ajaxTable[e].page=1,a("tfoot input",i).filter((a,e)=>e.value).each(function(){let t=a(this).parent().index();_ajaxTable[e].filteredData=_ajaxTable[e].filteredData.filter(a=>a.childNodes[t].hasAttribute("data-search")&&a.childNodes[t].attr("data-search").toLowerCase().includes(this.value.toLowerCase())||a.childNodes[t].innerText.toLowerCase().includes(this.value))}),_ajaxTable[e].filteredTotal=_ajaxTable[e].filteredData.length,d(i,e),t.onUpdate.call(void 0,i,_ajaxTable[e]))}else localStorage.removeItem(window.location.hostname+window.location.pathname+"_ajaxTable_"+e+"_search"),localStorage.removeItem(window.location.hostname+window.location.pathname+"_ajaxTable_"+e+"_orderBy"),localStorage.removeItem(window.location.hostname+window.location.pathname+"_ajaxTable_"+e+"_order"),localStorage.removeItem(window.location.hostname+window.location.pathname+"_ajaxTable_"+e+"_expires"),j=null;Math.floor((_ajaxTable[e].total-1)/10)+1>1&&t.source?c(2,e,i):(_ajaxTable[e].dataFullyLoaded=!0,t.printButtons&&(g[0].querySelector(".ajax-table-buttons").classList.add("available"),g[0].querySelector(".ajax-table-buttons-loader").classList.add("loaded")))}).catch(a=>{console.warn(a),alert(a)})}),this}})}(jQuery);